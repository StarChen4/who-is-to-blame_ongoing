# 项目开发对话上下文

## 项目背景

本项目是一个DOTA2比赛分析工具,能够基于科学方法论客观地找出比赛中表现最差的玩家("畜生")。

## 开发时间线

**开发日期**: 2026-01-30

### Phase 1: 需求分析与方法论制定

用户需求:
- 创建一个能够分析DOTA2比赛并找出"畜生"的工具
- 基于客观数据,而非主观判断
- 只分析输掉比赛的一方
- 需要考虑位置差异、克制关系等因素
- 输出幽默且详细的分析报告

制定方法论:
- 创建了完整的科学方法论文档 (`docs/methodology.md`)
- 定义了SSS到F级失误分类系统
- 设计了畜度计算公式(基础畜度 × 克制系数 × 位置系数 × 经济背景系数)
- 制定了畜生判定规则(最多2个,考虑位置平衡)

### Phase 2: 数据探索

探索OpenDota数据结构:
- 访问测试比赛 8669004890
- 检查概览、表现、分路、团战等各个标签页
- 确认数据字段和获取方式
- 发现需要触发"分析"功能才能获取详细数据

数据来源确定:
- **OpenDota**: 比赛基础数据、对线数据、团战数据
- **ProTracker**: 英雄克制关系数据(严格使用,不用OpenDota的matchups)

### Phase 3: Skill框架搭建

创建目录结构:
```
/d/projects/who-is-to-blame/
├── README.md
├── docs/
│   └── methodology.md
├── skills/
│   └── who-is-to-blame/
│       ├── skill.md
│       └── references/
│           ├── data-mapping.md
│           ├── analysis-logic.md
│           ├── error-handling.md
│           └── output-template.md
├── data/
│   ├── history.json
│   └── cache/
└── results/
```

设计理念:
- **模块化**: 主文件简洁,详细内容在references/中
- **可维护**: 每个模块职责清晰
- **易扩展**: 新增功能只需修改相应模块

### Phase 4: 文档编写

#### skill.md (主文件)
内容:
- Skill简介和核心原则
- 触发条件(斜杠命令 + 自然语言)
- 8步工作流程(从ID验证到保存结果)
- 引用references/中的详细文档
- 快速开始示例

特点:
- 简洁明了,5分钟内可理解全貌
- 详细内容通过链接引用
- 用户友好的触发方式设计

#### data-mapping.md (数据映射表)
内容:
- OpenDota各页面的详细数据映射
  - 概览页: KDA、GPM/XPM、伤害、治疗等
  - 表现页: 控制时间、拉野、死亡时长等
  - 分路页: 对线胜率、前10分钟数据
  - 团战页: 团战伤害、参团情况
  - 曲线图页: 经济曲线
- ProTracker克制数据获取方式
- 数据质量检查和异常处理
- 完整的数据结构示例

特点:
- 详尽的字段说明
- 实际示例值
- 数据获取顺序建议

#### analysis-logic.md (分析逻辑详解)
内容:
- 位置识别规则(基于分路数据或GPM)
- SSS到F级失误详细识别规则
  - SSS级: 核心位对线大崩、经济转化极差、辅助完全不参与
  - SS级: 对线严重劣势、团战贡献极低、推进能力缺失
  - S级: 对线失误、资源浪费、团战严重失误
  - A级: 发育效率低、团战站位失误、买活失误
  - B-F级: 死亡过多、反补低等小失误
- 系数调整详细计算方法
  - 克制系数: 0.7-1.3
  - 位置系数: 0.8-1.2
  - 经济背景系数: 0.8-1.2
- 畜生判定逻辑(数量控制、位置平衡)
- 罪状生成模板
- 特殊情况处理
- 完整的示例分析(比赛8669004890)

特点:
- 逻辑完整,可直接实现
- 大量代码示例
- 真实比赛分析演示

#### error-handling.md (错误处理指南)
内容:
- 10+种常见错误场景及处理方式:
  1. 比赛ID无效
  2. 比赛不存在
  3. 比赛未分析
  4. 网络错误
  5. 登录要求
  6. ProTracker访问失败
  7. 数据不完整
  8. 赢的一方误触发
  9. 平局或特殊比赛
  10. 数据解析错误
- 进度提示模板(7步完整流程)
- 用户交互设计(使用AskUserQuestion)
- 日志记录方案
- 降级策略

特点:
- 用户友好的错误提示
- 完整的降级处理
- 进度透明化

#### output-template.md (输出格式模板)
内容:
- 完整的Markdown报告模板
- 各部分详细说明:
  - 标题与比赛信息
  - 克制关系说明
  - 畜生判定结果
  - 罪状详情(含数据支撑)
  - 数据对比表格
  - 畜度计算过程
  - 全队排名
  - 幽默惩罚建议
  - 一句话总结
- 特殊情况输出(多个畜生、无明显畜生、数据不完整)
- 控制台输出设计
- 输出格式建议

特点:
- 完整的模板结构
- 大量示例文本
- 幽默与专业兼顾

#### README.md (项目说明)
内容:
- 项目简介和核心特点
- 项目结构说明
- 快速开始指南
- 技术架构说明
- 方法论概述
- 详细文档索引
- 注意事项和免责声明
- 常见问题(FAQ)
- 贡献指南
- 更新日志
- 致谢

特点:
- 全面的项目介绍
- 清晰的使用指南
- 专业的项目文档

### Phase 5: 辅助文件

#### history.json
初始化历史记录文件:
```json
{
  "version": "1.0.0",
  "total_matches_analyzed": 0,
  "position_bastard_count": {
    "1": 0, "2": 0, "3": 0, "4": 0, "5": 0
  },
  "matches": []
}
```

用途:
- 记录所有分析过的比赛
- 统计各位置背锅率
- 为长期分析提供数据支持

## 核心设计决策

### 1. 数据来源选择

**决策**: 严格使用ProTracker的克制数据,不使用OpenDota的matchups

**理由**:
- ProTracker基于职业比赛,更准确
- 用户在方法论中明确要求使用ProTracker
- OpenDota的matchups数据可能不够精确

### 2. 位置系数设计

**决策**: 核心位(1/2号位)系数1.2,辅助(4/5号位)系数0.8-0.9

**理由**:
- 核心位拥有更多资源,承担更大责任
- 避免"辅助背锅"现象
- 符合DOTA2游戏理解

### 3. 畜生数量控制

**决策**: 默认1个,最多2个,有位置平衡机制

**理由**:
- 避免"全员畜生"的无意义结果
- 确保指向性明确
- 体现"找畜生"而非"找问题"的娱乐性定位

### 4. 失误分级系统

**决策**: SSS到F共9级,不同级别贡献不同畜度

**理由**:
- 区分失误严重程度
- 使评分更加合理
- 便于生成详细罪状

### 5. 模块化文档结构

**决策**: 主文件简洁,详细内容在references/

**理由**:
- 提高可维护性
- 便于未来扩展
- 用户可按需阅读

## 技术挑战与解决方案

### 挑战1: 对话历史文件过大(21.5MB)

**问题**: 无法直接读取完整对话历史

**解决方案**: 创建摘要文档(本文件),记录关键信息而非完整对话

### 挑战2: 数据可能不完整

**问题**: OpenDota可能缺少部分数据

**解决方案**:
- 设计降级策略
- 必需数据 vs 可选数据
- 优雅的错误处理

### 挑战3: 分析复杂度高

**问题**: 需要考虑多个维度和调整系数

**解决方案**:
- 详细的分析逻辑文档
- 完整的计算示例
- 模块化的分析流程

## 待实现功能

虽然文档已完成,但实际代码还需要实现:

### 核心功能
1. ✅ 文档框架 - 已完成
2. ⏳ 数据获取模块 - 待实现
3. ⏳ 分析引擎 - 待实现
4. ⏳ 报告生成 - 待实现
5. ⏳ 错误处理 - 待实现

### 测试计划
- 使用比赛8669004890进行测试
- 验证数据获取准确性
- 验证分析逻辑合理性
- 验证输出格式正确性

## 项目价值

### 技术价值
- 完整的数据分析框架
- 科学的评分系统
- 可扩展的模块化设计

### 用户价值
- 客观的比赛分析
- 详细的数据支撑
- 娱乐性强的输出

### 学习价值
- 数据驱动的决策
- 复杂系统的设计
- 用户体验的优化

## 参考资料

- OpenDota API文档: https://docs.opendota.com/
- ProTracker: https://dota2protracker.com/
- DOTA2游戏机制: Valve官方文档
- 方法论文档: `/d/projects/who-is-to-blame/docs/methodology.md`

## 总结

本项目通过科学的方法论和详细的文档设计,构建了一个完整的DOTA2比赛分析框架。虽然实际代码还待实现,但文档已经为实现提供了清晰的路线图。

**核心理念**: 数据驱动、客观公正、用户友好、娱乐至上

**下一步**: 基于这些文档实现实际的分析代码

---

*本文档记录了项目从构思到文档完成的完整过程*
*对话历史文件位置: C:\Users\84208\.claude\projects\C--Users-84208\2080ce70-c305-4920-95be-2d77e54b12de.jsonl*
*由于文件过大(21.5MB),本文档为核心内容摘要*
